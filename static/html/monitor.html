<!DOCTYPE html>
<html>
<head>
    <title>사고 감지 모니터링</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .notification { padding: 10px; background-color: #f8d7da; border: 1px solid #f5c6cb; margin-bottom: 10px; border-radius: 4px; }
        #notifications { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>고속도로 사고 감지 실시간 모니터링</h1>
    <div>
        <button id="connectBtn">웹소켓 연결</button>
        <button id="disconnectBtn" disabled>연결 끊기</button>
    </div>
    <div id="status">상태: 연결되지 않음</div>
    <h2>실시간 알림</h2>
    <div id="notifications"></div>
    <script>
        let socket;

        document.getElementById('connectBtn').addEventListener('click', () => {
            socket = new WebSocket(`ws://${window.location.hostname}:8000/ws`);
            socket.onopen = function(e) {
                document.getElementById('status').innerText = '상태: 연결됨';
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('disconnectBtn').disabled = false;
                console.log('WebSocket 연결됨');
            };
            socket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                console.log('메시지 수신:', data);
                const notifDiv = document.createElement('div');
                notifDiv.className = 'notification';
                if (data.type === 'accident_alert' || data.type === 'accident_detected') {
                    const accidentData = data.data || data;
                    notifDiv.innerHTML = `
                        <strong>사고 감지!</strong><br>
                        시간: ${new Date().toLocaleString()}<br>
                        위치: ${accidentData.location || '알 수 없음'}<br>
                        CCTV: ${accidentData.cctv_name || '알 수 없음'}<br>
                        유형: ${accidentData.accident_type || '알 수 없음'}<br>
                        심각도: ${accidentData.severity || '알 수 없음'}
                    `;
                } else {
                    notifDiv.innerText = JSON.stringify(data);
                }
                document.getElementById('notifications').prepend(notifDiv);
            };
            socket.onclose = function(event) {
                document.getElementById('status').innerText = '상태: 연결 끊김';
                document.getElementById('connectBtn').disabled = false;
                document.getElementById('disconnectBtn').disabled = true;
                console.log('WebSocket 연결 끊김');
            };
            socket.onerror = function(error) {
                console.error('WebSocket 오류:', error);
                document.getElementById('status').innerText = '상태: 오류 발생';
            };
        });
        document.getElementById('disconnectBtn').addEventListener('click', () => {
            if (socket) {
                socket.close();
            }
        });
    </script>
</body>
</html>
